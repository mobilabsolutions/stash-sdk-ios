<!DOCTYPE html>
<html lang="en">
  <head>
    <title>StashBraintree  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="StashBraintree  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          StashBraintree Docs
        </a>
        
      </p>
    
      <p class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/mobilabsolutions/payment-sdk-ios-open">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">StashBraintree Reference</a>
      <img class="carat" src="img/carat.png" />
      StashBraintree  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/StashBraintree.html">StashBraintree</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/StashBraintreeBridge.html">StashBraintreeBridge</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <h1 id='stash-ios-sdk' class='heading'>Stash iOS SDK</h1>

<p><a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a> <a href="https://travis-ci.com/mobilabsolutions/payment-sdk-ios-open"><img src="https://travis-ci.com/mobilabsolutions/payment-sdk-ios-open.svg?token=YveRxJtU3TcdBx4pp777&branch=master" alt="Travis CI build status"></a></p>

<p>Many applications need to process payments for digital or physical goods. Implementing payment functionality can be very cumbersome though: there are many payment service providers that support or don&rsquo;t support various types of payment methods and payment method registration and usage flows. The payment SDK simplifies the integration of payments into our applications and abstracts away a lot of the internal complexity that different payment service providers&rsquo; solutions have. With the payment SDK it does not matter which payment service provider one chooses to register payment methods with - the API is standardized and works across the board. </p>
<h2 id='supported-psps' class='heading'>Supported PSPs</h2>

<p>At the moment, the Stash iOS SDK supports the following PSPs:</p>

<ul>
<li>BSPayone [Credit Cards / SEPA]</li>
<li>Braintree [PayPal]</li>
<li>Adyen [Credit Cards / SEPA]</li>
</ul>
<h2 id='requirements' class='heading'>Requirements</h2>

<p>To build this project, you will need to have at least the following:</p>

<ul>
<li>iOS 11.3+</li>
<li>Xcode 10.1+</li>
<li>Swift 5.0+ / Objective-C
_ Carthage</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>

<p>We recommend using <a href="https://github.com/Carthage/Carthage">Carthage</a> to integrate the MobilabPayment SDK with your project.</p>
<h3 id='carthage' class='heading'>Carthage</h3>

<p>Add <code>github &quot;mobilabsolutions/payment-sdk-ios-open&quot; ~&gt; 1.0</code> to your <code>Cartfile</code>, and follow <a href="https://github.com/Carthage/Carthage#getting-started">Carthage building instructions</a> to complete installation. The input file list for the Carthage <code>copy-frameworks</code> build phase should contain dependencies found in our <a href="Sample/other/input.xcfilelist"> sample application input file list</a> so feel free to use it as an example.</p>
<h3 id='manual-installation' class='heading'>Manual Installation</h3>

<p>The SDK can also be installed manually. To perform manual installation, drag the <code>MobilabPaymentCore</code> framework and the module frameworks you might want to use into the <code>Embdedded Binaries</code> section in Xcode. Depending on the modules that you want to use, you will also have to install their dependencies. The recommended option for this is using <a href="https://github.com/Carthage/Carthage">Carthage</a> with the following <code>Cartfile</code> contents for installing the dependencies of the Braintree and Adyen modules:</p>
<pre class="highlight plaintext"><code>github "braintree/braintree-ios-drop-in" ~&gt; 7.2.0
github "adyen/adyen-ios" ~&gt; 2.8
</code></pre>

<p>Instructions for installing dependencies with Carthage can be found <a href="#carthage">above</a></p>
<h2 id='usage' class='heading'>Usage</h2>
<h3 id='configuring-the-sdk' class='heading'>Configuring the SDK</h3>

<p>To use the SDK, you need to initialize it with some configuration data. Among the data that needs to be provided are the merchant publishable key as well as the backend endpoint that should be used by the SDK.</p>

<p>To connect the SDK to a given PSP, that PSP&rsquo;s module needs to be imported and initialized. You need to set the configuration&rsquo;s <code>integrations</code> to provide correct data.</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">MobilabPaymentCore</span>
<span class="kd">import</span> <span class="kt">MobilabPaymentBSPayone</span>
<span class="kd">import</span> <span class="kt">MobilabPaymentBraintree</span>

<span class="k">let</span> <span class="nv">bsPayonePSP</span> <span class="o">=</span> <span class="kt">MobilabPaymentBSPayone</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">braintreePSP</span> <span class="o">=</span> <span class="kt">MobilabPaymentBraintree</span><span class="p">(</span><span class="nv">urlScheme</span><span class="p">:</span> <span class="s">"[YOUR URL SCHEME]]"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">MobilabPaymentConfiguration</span><span class="p">(</span><span class="nv">publishableKey</span><span class="p">:</span> <span class="s">"[YOUR MOBILAB BACKEND PUBLISHABLE KEY]"</span><span class="p">,</span> 
                                                <span class="nv">endpoint</span><span class="p">:</span> <span class="s">"[YOUR MOBILAB BACKEND ENDPOINT]"</span><span class="p">,</span>
                                                <span class="nv">integrations</span><span class="p">:</span> <span class="p">[</span>
                                                    <span class="kt">PaymentProviderIntegration</span><span class="p">(</span><span class="nv">paymentServiceProvider</span><span class="p">:</span> <span class="n">bsPayonePSP</span><span class="p">),</span>
                                                    <span class="kt">PaymentProviderIntegration</span><span class="p">(</span><span class="nv">paymentServiceProvider</span><span class="p">:</span> <span class="n">braintreePSP</span><span class="p">)</span>
                                                <span class="p">])</span>
<span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">initialize</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
</code></pre>

<p>It is also possible to specify which PSP should be used to register which payment method type by using the <code>paymentMethodTypes</code> parameter of the <code>PaymentProviderIntegration</code> optional initializer. By default, when the specific payment method types are not specified, the PSP will be used for all types that the module supports. Note that a <code>fatalError</code> will be created when there are overlapping payment method types for different PSPs that are registered at the same time.</p>
<h4 id='using-the-sdk-in-test-mode' class='heading'>Using the SDK in Test Mode</h4>

<p>The Stash SDK can also be used in so-called test mode. The transactions created there are not forwarded to the production PSP, but rather to whatever sandboxing mode the PSP provides.
To instruct the SDK to use the test mode, set manually the <code>useTestMode</code> property on the <code>MobilabPaymentConfiguration</code> used to configure the SDK.</p>

<p>For example:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">configuration</span> <span class="o">=</span> <span class="kt">MobilabPaymentConfiguration</span><span class="p">(</span><span class="nv">publishableKey</span><span class="p">:</span> <span class="s">"[YOUR MOBILAB BACKEND PUBLISHABLE KEY]"</span><span class="p">,</span> 
                                                <span class="nv">endpoint</span><span class="p">:</span> <span class="s">"[YOUR MOBILAB BACKEND ENDPOINT]"</span><span class="p">,</span>
                                                <span class="nv">integrations</span><span class="p">:</span> <span class="p">[</span><span class="kt">PaymentProviderIntegration</span><span class="p">(</span><span class="nv">paymentServiceProvider</span><span class="p">:</span> <span class="n">bsPayonePSP</span><span class="p">)])</span>
<span class="n">configuration</span><span class="o">.</span><span class="n">useTestMode</span> <span class="o">=</span> <span class="kc">true</span>

<span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">initialize</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">configuration</span><span class="p">)</span>
</code></pre>
<h2 id='registering-a-payment-method' class='heading'>Registering a Payment Method</h2>

<p>To register a payment method you need an instance of the <code>RegistrationManager</code> class.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
</code></pre>

<p>As the Stash SDK allows the usage of multiple PSPs, when registering a payment method you need to set the PSP you want to use for that particular payment method.
Depending on the payment method that is being used, some registration methods could require additional data.</p>
<h3 id='using-the-module-ui-for-adding-a-payment-method' class='heading'>Using the Module UI for Adding a Payment Method</h3>

<p>Since the PSP modules know which data needs to be provided in each situation, it is also possible to offload the UI work to add a payment method to them. By calling the <code>registerPaymentMethodUsingUI</code> on the registration manager, the user is shown a selection of possible payment method types and then the fields used for creating the payment method type that was selected.</p>

<p><em>Note</em>: To allow the registration of a PayPal account, some setup work, as documented in the <a href="#registering-a-paypal-account">Registering a PayPal account</a> section of this page, is necessary.</p>

<p>The typical usage of this functionality might look like this:</p>
<pre class="highlight swift"><code>
<span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
<span class="n">registrationManager</span><span class="o">.</span><span class="nf">registerPaymentMethodUsingUI</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">registration</span><span class="p">):</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">showAlert</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Success"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="s">"Successfully registered payment method"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">showAlert</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Failure"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>It is also possible to style the presented UI in a way that is compatible with the style guide of the rest of the containing application. You only need to pass along an updated <code>PaymentMethodUIConfiguration</code>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">uiConfiguration</span> <span class="o">=</span> <span class="kt">PaymentMethodUIConfiguration</span><span class="p">(</span><span class="nv">backgroundColor</span><span class="p">:</span> <span class="o">.</span><span class="n">white</span><span class="p">,</span> <span class="nv">textColor</span><span class="p">:</span> <span class="o">.</span><span class="n">black</span><span class="p">,</span> <span class="nv">buttonColor</span><span class="p">:</span> <span class="o">.</span><span class="n">black</span><span class="p">)</span>
<span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">configureUI</span><span class="p">(</span><span class="nv">configuration</span><span class="p">:</span> <span class="n">uiConfiguration</span><span class="p">)</span>

<span class="n">registrationManager</span><span class="o">.</span><span class="nf">registerPaymentMethodUsingUI</span><span class="p">(</span><span class="n">on</span> <span class="nv">viewController</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">registration</span><span class="p">):</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">showAlert</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Success"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="s">"Successfully registered payment method"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">showAlert</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Failure"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You can find more information about this in the <a href="https://github.com/mobilabsolutions/payment-sdk-ios-open/wiki/SDK-UI-Usage-Tutorial">SDK UI Usage Tutorial</a> in our Wiki.</p>
<h3 id='credit-card-registration' class='heading'>Credit Card Registration</h3>

<p>To register a credit card, the <code>registerCreditCard</code> method of the registration manager is used. You should provide it with an instance of the <code>CreditCardData</code>, which upon initialization also validates the credit card data.</p>

<p>The <code>CreditCardData</code> is provided with the <code>BillingData</code>. This <code>BillingData</code> contains information about the user that is necessary to register a credit card. Its fields are all optional and their necessity is PSP-dependant. As with all the registration methods, you also need to set the PSP you want to use to register the credit card.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="kt">SimpleNameProvider</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"Max"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Mustermann"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">billingData</span> <span class="o">=</span> <span class="kt">BillingData</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="nv">country</span><span class="p">:</span> <span class="s">"DE"</span><span class="p">)</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">creditCard</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">CreditCardData</span><span class="p">(</span><span class="nv">cardNumber</span><span class="p">:</span> <span class="s">"4111111111111111"</span><span class="p">,</span> <span class="nv">cvv</span><span class="p">:</span> <span class="s">"123"</span><span class="p">,</span>
                                        <span class="nv">expiryMonth</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nv">expiryYear</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="nv">country</span><span class="p">:</span> <span class="s">"DE"</span><span class="p">,</span> <span class="nv">billingData</span><span class="p">:</span> <span class="n">billingData</span><span class="p">)</span>
<span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Credit card data is not valid"</span><span class="p">)</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
<span class="n">registrationManager</span><span class="o">.</span><span class="nf">registerCreditCard</span><span class="p">(</span><span class="nv">creditCardData</span><span class="p">:</span> <span class="n">creditCard</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">registration</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Received alias for credit card: </span><span class="se">\(</span><span class="n">registration</span><span class="o">.</span><span class="n">alias</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Error (</span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="se">)</span><span class="s">) while registering credit card"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='sepa-registration' class='heading'>SEPA Registration</h3>

<p>To register a SEPA account, we can use the <code>registerSEPAAccount</code> method of the registration manager. Here, as is the case of the credit card data, the billing data is optional and the values that need to be provided are PSP-dependant.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="kt">SimpleNameProvider</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"Max"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Mustermann"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">billingData</span> <span class="o">=</span> <span class="kt">BillingData</span><span class="p">(</span><span class="nv">email</span><span class="p">:</span> <span class="s">"max@mustermann.de"</span><span class="p">,</span>
                                      <span class="nv">name</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                                      <span class="nv">address1</span><span class="p">:</span> <span class="s">"Address1"</span><span class="p">,</span>
                                      <span class="nv">address2</span><span class="p">:</span> <span class="s">"Address2"</span><span class="p">,</span>
                                      <span class="nv">zip</span><span class="p">:</span> <span class="s">"817754"</span><span class="p">,</span>
                                      <span class="nv">city</span><span class="p">:</span> <span class="s">"Cologne"</span><span class="p">,</span>
                                      <span class="nv">state</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
                                      <span class="nv">country</span><span class="p">:</span> <span class="s">"DE"</span><span class="p">,</span>
                                      <span class="nv">phone</span><span class="p">:</span> <span class="s">"1231231123"</span><span class="p">,</span>
                                      <span class="nv">languageId</span><span class="p">:</span> <span class="s">"deu"</span><span class="p">)</span>

<span class="k">guard</span> <span class="k">let</span> <span class="nv">sepaData</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">SEPAData</span><span class="p">(</span><span class="nv">iban</span><span class="p">:</span> <span class="s">"DE75512108001245126199"</span><span class="p">,</span> <span class="nv">bic</span><span class="p">:</span> <span class="s">"COLSDE33XXX"</span><span class="p">,</span> <span class="nv">billingData</span><span class="p">:</span> <span class="n">billingData</span><span class="p">)</span>
<span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"SEPA data should be valid"</span><span class="p">)</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
<span class="n">registrationManager</span><span class="o">.</span><span class="nf">registerSEPAAccount</span><span class="p">(</span><span class="nv">sepaData</span><span class="p">:</span> <span class="n">sepaData</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">registration</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Received alias for SEPA account: </span><span class="se">\(</span><span class="n">registration</span><span class="o">.</span><span class="n">alias</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Error (</span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="se">)</span><span class="s">) while registering SEPA account"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='paypal-account-registration' class='heading'>PayPal Account Registration</h3>

<p>Currently, only the Braintree PSP allows registering a PayPal account and it is  possible to register a PayPal account only by using the provided module UI.</p>
<h4 id='setup-for-app-switch' class='heading'>Setup for App Switch</h4>

<p>The PayPal account registration flow involves switching to another app or  <code>SFSafariViewController</code>  for authentication, so you must register a URL type and configure your app to return from the app switches.</p>
<h4 id='register-a-url-type' class='heading'>Register a URL Type</h4>

<ol>
<li>In the Xcode, click on your project in the Project Navigator and navigate to  <strong>App Target</strong>  &gt;  <strong>Info</strong>&gt;  <strong>URL Types</strong>.</li>
<li>Click on <strong>[+]</strong>  to add a new URL type.</li>
<li>Under the <strong>URL Schemes</strong>, enter your app switch return URL scheme. This scheme  <strong><em>must start with your app&rsquo;s Bundle ID and be dedicated to MobilabPayment app switch returns</em></strong>. For example, if the app bundle ID is  <code>com.your-company.Your-App</code>, then your URL scheme could be  <code>com.your-company.Your-App.mobilab</code>.</li>
</ol>
<h4 id='update-your-application-delegate' class='heading'>Update your application delegate</h4>

<p>In your AppDelegate&rsquo;s  <code>application:didFinishLaunchingWithOptions:</code>  implementation, use  <code>setReturnURLScheme:</code>  with the URL type value you set above.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="nv">_</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplication</span><span class="o">.</span><span class="kt">OpenURLOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kt">MobilabPaymentBraintree</span><span class="o">.</span><span class="nf">handleOpen</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Now you are ready to register a PayPal account.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
<span class="n">registrationManager</span><span class="o">.</span><span class="nf">registerPaymentMethodUsingUI</span><span class="p">(</span><span class="n">on</span> <span class="nv">viewController</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">specificPaymentMethod</span><span class="p">:</span> <span class="o">.</span><span class="n">payPal</span><span class="p">)</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">registration</span><span class="p">):</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">dismiss</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">showAlert</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Success"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="s">"Successfully registered payment method"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
        <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">showAlert</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"Failure"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='idempotency' class='heading'>Idempotency</h2>

<p>All calls provided by Payment SDK are idempotent <strong>only if the underlying PSP is also idempotent</strong> (Braintree is not, BS Payone and Adyen are not for credit card registration). To use idempotency simply provide a unique string to any of the manual non-UI registration methods used.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="kt">SimpleNameProvider</span><span class="p">(</span><span class="nv">firstName</span><span class="p">:</span> <span class="s">"Max"</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="s">"Mustermann"</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">billingData</span> <span class="o">=</span> <span class="kt">BillingData</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="nv">country</span><span class="p">:</span> <span class="s">"DE"</span><span class="p">)</span>
<span class="k">guard</span> <span class="k">let</span> <span class="nv">creditCard</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">CreditCardData</span><span class="p">(</span><span class="nv">cardNumber</span><span class="p">:</span> <span class="s">"4111111111111111"</span><span class="p">,</span> <span class="nv">cvv</span><span class="p">:</span> <span class="s">"123"</span><span class="p">,</span>
                                        <span class="nv">expiryMonth</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="nv">expiryYear</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="nv">country</span><span class="p">:</span> <span class="s">"DE"</span><span class="p">,</span> <span class="nv">billingData</span><span class="p">:</span> <span class="n">billingData</span><span class="p">)</span>
<span class="k">else</span> <span class="p">{</span> <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Credit card data is not valid"</span><span class="p">)</span> <span class="p">}</span>

<span class="k">let</span> <span class="nv">registrationManager</span> <span class="o">=</span> <span class="kt">MobilabPaymentSDK</span><span class="o">.</span><span class="nf">getRegistrationManager</span><span class="p">()</span>
<span class="n">registrationManager</span><span class="o">.</span><span class="nf">registerCreditCard</span><span class="p">(</span><span class="nv">creditCardData</span><span class="p">:</span> <span class="n">creditCard</span><span class="p">,</span> <span class="nv">idempotencyKey</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">()</span><span class="o">.</span><span class="n">uuidString</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">registration</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Received alias for credit card: </span><span class="se">\(</span><span class="n">registration</span><span class="o">.</span><span class="n">alias</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="s">"Error (</span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">description</span><span class="se">)</span><span class="s">) while registering credit card"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='demo' class='heading'>Demo</h2>

<p>A demo app that demonstrates the usage of all the Stash SDK features is part of this project. Run  <code>carthage bootstrap --platform iOS</code>, open <code>MobilabPayment.xcworkspace</code> in Xcode and then choose the <code>Demo</code> scheme to launch it.</p>
<h2 id='feedback' class='heading'>Feedback</h2>

<p>The Stash iOS SDK is in active development, we welcome your feedback!
Please use <a href="https://github.com/mobilabsolutions/payment-sdk-ios-open/issues">GitHub Issues</a> to report an issue or give a feedback.</p>
<h3 id='license' class='heading'>License</h3>

<p>The Stash iOS SDK is open source and available under the TODO license. See the <a href="https://github.com/mobilabsolutions/payment-sdk-ios-open/blob/master/LICENSE">LICENSE</a> file for more info.</p>
<h2 id='documentation' class='heading'>Documentation</h2>

<p>To get familiar with the overall Stash SDK project please visit <a href="https://github.com/mobilabsolutions/payment-sdk-wiki-open/wiki">Common payment wiki</a>.
To learn more about the Stash iOS SDK architecture and flows please visit our <a href="https://github.com/mobilabsolutions/payment-sdk-ios-open/wiki">Wiki</a></p>

<p>The reference documentation for each module is available in the <code>docs/</code> folder of this repository. To regenerate the reference documentation, run <code>./build_documentation.sh</code>.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>Copyright MobiLab Solutions GmbH 2019</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
