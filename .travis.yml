language: objective-c
osx_image: xcode10.2

cache:
  directories:
  - Carthage

env:
  #environment variables
  global:
    - PROJECT_NAME="MobilabPayment.xcodeproj"
  matrix:
    - DESTINATION="OS=12.2,name=iPhone X"

before_install:
  - gem install xcpretty
  - gem install xcpretty-travis-formatter
  - brew install carthage || true
  - brew outdated carthage || brew upgrade carthage

before_script:
  - carthage update --cache-builds --platform iOS

script:
  - set -e
  - set -o pipefail
  - echo "Starting Unit Tests"
  - travis_retry xcodebuild clean test -project "$PROJECT_NAME" -scheme "MobilabPaymentCore" -destination "$DESTINATION" test | xcpretty -f `xcpretty-travis-formatter`
  - echo "Starting UI Tests"
  - xcodebuild test -project "$PROJECT_NAME" -scheme "Sample" -destination "$DESTINATION" test | xcpretty -f `xcpretty-travis-formatter`
  - echo "Building Objective-C Sample"
  - xcodebuild -project "$PROJECT_NAME" -scheme "Sample-ObjC" -destination "$DESTINATION" | xcpretty -f `xcpretty-travis-formatter`
  - echo "Building Demo application"
  - xcodebuild -project "$PROJECT_NAME" -scheme "Demo" -destination "$DESTINATION" | xcpretty -f `xcpretty-travis-formatter`
